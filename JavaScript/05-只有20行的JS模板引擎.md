---
typora-copy-images-to: img\05
---

# 只有20行的JS模板引擎

原文：[JavaScript template engine in just 20 lines](http://krasimirtsonev.com/blog/article/Javascript-template-engine-in-just-20-line)

## ★引子

为什么要阅读这篇文章？最近在看一个关于「实现一个MVVM框架」的视频，当我观看到关于对单向绑定的实现时，我就卡住了！具体卡住的点是关于模板实现那部分内容！于是我就搜索了有关模板的内容：

**➹：**[如何实现一个基于 DOM 的模板引擎 - 知乎](https://zhuanlan.zhihu.com/p/28376182)

**➹：**[yanhaijing/template.js: A javascript template engine, simple, easy & extras, support webpack and fis](https://github.com/yanhaijing/template.js)

**➹：**[只有20行Javascript代码！手把手教你写一个页面模板引擎 - 文章 - 伯乐在线](http://blog.jobbole.com/56689/)

秉持着看一手资料原则，所以我就先试着自己翻译一遍原文吧！

---

 我仍然在研究我的基于JavaScript的预处理器——[AbsurdJS](http://krasimirtsonev.com/blog/article/AbsurdJS-fundamentals)（荒谬的JS，建议大概看一下这个链接里边的内容）。它最初是作为CSS预处理器开始的，但是后来它被扩展为了CSS / HTML预处理器。很快，它就能真正允许JavaScript到CSS/HTML的转换了。当然，由于它生成的是HTML，所以你把它充当成模板引擎也是正常的。即，你可以通过某种方式实现用数据填充标记哈！

因此，我想编写一个简单的模板引擎逻辑，而且它与我当前的这个实现AbsurdJS能够很好地配合。 [AbsurdJS](http://krasimirtsonev.com/blog/article/AbsurdJS-fundamentals)主要作为一个NodeJS模块发布，但是它也可以被移植到客户端使用。考虑到这一点，我就知道无法使用现有的一些引擎了，毕竟它们里边的大多数代码都是基于Node这个环境所运行的，因此复制它们到浏览器里边跑起来显然是很无厘头的一件事。我需要一些用纯JavaScript代码编写的小东西。偶然的某一天，我浏览了 [John Resig](http://ejohn.org/)的这篇[博客](http://ejohn.org/blog/javascript-micro-templating/)。文章里边所介绍的内容，看起来就像是我所需要的东西。然后我稍微修改了一下它，让它大概在20行代码左右。我认为这里边的代码逻辑非常有意思。在这篇文章中，我将一步一步地重建这个模板引擎，这样你就可以看到最初来自约翰的奇妙想法。

 这是我们一开始就可以拥有的（**起点**）：

```js
var TemplateEngine = function(tpl, data) {
    // magic here ...
}
var template = '<p>Hello, my name is <%name%>. I\'m <%age%> years old.</p>';
console.log(TemplateEngine(template, {
    name: "Krasimir",
    age: 29
}));
```

一个简单的函数，它接受我们的模板和数据对象。正如您可能猜到的那样，我们最终想要达到的结果是（**终点**）：

```html
<p>Hello, my name is Krasimir. I'm 29 years old.</p>
```

> 以上过程可以理解为输入和输出！

 我们必须要做的第一件事就是**在模板中获取动态块**（dynamic blocks）。稍后，我们将用传递给该模板引擎的真实数据替换掉它们。我决定使用正则表达式来实现这一点。不过，这不是我的强项，所以请阅读这篇文章的你们随意评论一下，并推荐一个更好的RegExp。

```js
var re = /<%([^%>]+)?%>/g;
```

> 我之前所了解的语法是大胡子语法，即 \{\{xxx}}，而在这里则是 `<%xxx%>`，不过也差不多啦！
>
> 关于这个正则表达式所描述的子串正是 我们所要获取的动态块！
>
> 不过按照我目前对正则的理解， 你得去看看JS的变量命名规范（不过默认是遵循该规则的）！



## ★总结

- 可以去看看JavaScript忍者揭秘这本书，听说第一版徐涛翻译的有毒，不过豆瓣评分有8.7啊！当然，就目前而言，已经出了[第二版](https://book.douban.com/subject/30143702/)的，是18年出的中文版，这次翻译则是个前端小组翻译的！

  **➹：**[《JavaScript 忍者秘籍》里关于原型的介绍出错了吗？ - 知乎](https://www.zhihu.com/question/45545910)


  


  


    